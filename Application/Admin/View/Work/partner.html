<include file="Index/header" />
<div id="main" >
    <style>
        .toolbar li{text-align: center;padding: 0 !important;width: 50px;}
        .toolbar li.current{color: #FFFFFF;background: #3EAFE0 !important;}
        .toolbar1 li{cursor: pointer}
    </style>
    <div class="place">
        <span>位置：</span>
        <ul class="placeul">
            <li><a href="#">首页</a></li>
            <li><a href="#">工作管理</a></li>
            <li><a href="#">客户管理</a></li>
        </ul>
    </div>

    <div class="rightinfo">
        <div class="tools">
			 <div style="float:left">总共客户：<font color="blue">{$count}个</font></div>
            <ul class="toolbar1">				
                <li class="add_btn"><span><img src="{:C('STATIC_URL')}/images/t01.png"/></span>添加</li>
            </ul>
        </div>
		<div class="tools" style="line-height: 46px">
            <form method="get" action="">
            公司名称：<input name="partner_name" type="text" class="dfinput" value="{$partner_name}" style="width: 200px;">&nbsp;
			 <if condition="$special eq 1">
			 业务员：<select name="owner" class="dfinput" style="width: 100px;">
                    <option value="">全部</option>                   
                    <volist name="userlist" id="vo">
					<option value="{$vo.user_number}" <if condition="$owner eq $vo['user_number']">selected</if>>{$vo.username}</option>
					</volist>
                </select>&nbsp;
			</if>
            客户类型：<select name="khtype" class="dfinput" style="width: 100px;">
                    <option value="">全部类型</option>                   
                    <option value="短期" <if condition="$khtype eq 短期">selected</if>>短期</option>
					<option value="长期" <if condition="$khtype eq 长期">selected</if>>长期</option>
                </select>&nbsp;
			 客户状态：<select name="status" class="dfinput" style="width: 100px;">
                    <option value="">全部状态</option>                   
                    <option value="1">合作中</option>
					<option value="2">未合作</option>
                </select>&nbsp;
            <input name="search" type="submit" class="btn" value="查询">
            </form>
        </div>
        <div class="tablelist_w new_tablelist">
            <table class="tablelist">
                <thead>
                <tr>
                    <th>公司名称</th>
                    <th>合作类型</th>
                    <th>联系人</th>
					<th>联系电话</th>
                    <th>微信</th>
                    <th>qq</th>
					<th>地址</th>
					<th>状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                    <volist name="list" id="vo">
                        <tr data-id="{$vo.id}">
                            <td class="td_partner_name">{$vo.partner_name}</td>
                            <td>{$vo.khtype}</td>
                            <td>{$vo.partner_name}</td>
                            <td >{$vo.tel}</td>
                            <td>{$vo.weixin}</td>
                            <td>{$vo.qq}</td>                            
							<td>{$vo.address}</td>
                            <td>
								<if condition="$vo['status'] eq 0">
								未合作
								<else/>
								合作
								</if>
							</td>                                 
                            <td><a href="javascript:;" class="tablelink edit">信息</a> <a href="javascript:;" class="tablelink detail">跟踪</a> <a href="javascript:;" class="tablelink gx">共享</a></td>
                        </tr>
                    </volist>
                </tbody>
            </table>
            <div class="page">{$pagebar}</div>
        </div>
    </div>
</div>

<div id="add_temp" style="display: none">
    <ul class="forminfo">
        <form class="dataform" method="post" enctype="multipart/form-data" action="{:U('Work/addPartner')}">
            <input type="hidden" class="input_id" name="id" value="">
            <input type="hidden" class="input_fieldtype" name="fieldtype" value="partner">
            <li><label>客户名称</label><input name="partner_name" type="text" class="dfinput input_partner_name" value="" style="width: 300px"/></li>
            ##FORM##
            <li><label>&nbsp;</label><input name="submit" type="button" class="btn do_save_btn" value="确认保存"/></li>
        </form>
    </ul>
</div>

<script>
    var layer_index;
    $(document).on('click', '.add_btn', function () {       
        $.ajax({
            type:'post',
            dataType:'json',
            data:{fieldtype:'partner'},
            url:"{:U('Common/getFieldForm')}",
            success:function (response) {
                layer_index = layer.open({
                    type: 2,
                    title: '添加合同',
                    skin: 'layui-layer-rim',
                    area: ['100%', '100%'],
                    scrollbar: false,
                    content: "/Work/addPartner"
                });
            }
        });
    });
    
	$(document).on('click', '.gx', function () {
		var tr = $(this).parents('tr');
        var id = tr.attr('data-id');
		layer_index = layer.open({
			type: 2,
			title: '添加合同',
			skin: 'layui-layer-rim',
			area: ['80%', '80%'],
			scrollbar: false,
			content: "/partner/gxpartner/pid/"+id
		});
    });
	
    $(document).on('click', '.edit', function () {
        var tr = $(this).parents('tr');
        var id = tr.attr('data-id');
        if (!id || id == '') return false;
        layer_index = layer.open({
            type: 2,
            title: '编辑合同',
            skin: 'layui-layer-rim',
            area: ['100%', '100%'],
            scrollbar: false,
            content: "/Work/editPartner?id="+id
        });
    });

    //编辑
    function editData(con) {
        var load = layer.load(1);
        con.ajaxSubmit({
            type:'post',
            dataType:'json',
            url:"{:U('Work/editPartner')}",
            error:function () {
                layer.close(load);
            },
            success:function (response) {
                layer.close(load);
                if (response.code == 1) {
                    layer.msg('保存成功', {icon: 1,time: 1000}, function(){
                        location.reload();
                    });
                }else {
                    layer.msg(response.msg, {icon: 2,time: 1000});
                }
            }
        });
    }
    
    $(document).on('click', '.detail', function () {
        var tr = $(this).parents('tr');
        var id = tr.attr('data-id'); 
		layer_index = layer.open({
			type: 2,
			title: '合同详情',
			skin: 'layui-layer-rim',
			area: ['60%', '98%'],
			shade: 0.1,
			scrollbar: false,
			content: '/Partner/detail/id/'+id,
			end: function () {
				location.reload() 
			}
		});
    });
    
</script>

<include file="Index/footer" />
