<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<include file="Index/header" />
<div id="main" >
<div class="place">
    <span>位置：</span>
    <ul class="placeul">
        <li><a href="#">首页</a></li>
        <li><a href="#">权限管理</a></li>
        <li><a href="#">账户管理</a></li>
    </ul>
</div>

<div class="rightinfo">

    <div class="tools">

        <ul class="toolbar">
            <li class="add_btn"><span><img src="{:C('STATIC_URL')}/images/t01.png"/></span>添加</li>
            <li class="click"><span><img src="{:C('STATIC_URL')}/images/t02.png"/></span>修改</li>
            <li><span><img src="{:C('STATIC_URL')}/images/t03.png"/></span>删除</li>
            <li><span><img src="{:C('STATIC_URL')}/images/t04.png"/></span>统计</li>
        </ul>


        <ul class="toolbar1">
            <li><span><img src="{:C('STATIC_URL')}/images/t05.png"/></span>设置</li>
        </ul>

    </div>


    <table class="tablelist">
        <thead>
        <tr>
            <th>ID</th>
            <th>用户名</th>
            <th>昵称</th>
            <th>角色</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <volist name="list" id="vo">
            <tr>
                <td class="td_id">{$vo.id}</td>
                <td class="td_username">{$vo.username}</td>
                <td class="td_nickname">{$vo.nickname}</td>
                <td class="td_role" data-roleid="{$vo.role_id}">{$vo.rolename}</td>
                <td><a href="javascript:;" class="tablelink edit_btn">修改</a> <a href="javascript:;" class="tablelink dele_btn"> 删除</a></td>
            </tr>
        </volist>
        </tbody>
    </table>

    <div id="add_temp" style="display: none">
        <ul class="forminfo">
            <input type="hidden" class="input_id" value="">
            <li><label>用户名</label><input name="username" type="text" class="dfinput input_username" style="width: 300px" /></li>
            <li><label>密码</label><input name="password" type="password" class="dfinput input_password" style="width: 300px" /></li>
            <li><label>昵称</label><input name="nickname" type="text" class="dfinput input_nickname" style="width: 300px" /></li>
            <li>
                <label>角色</label>
                <select class="dfinput input_role_id" style="width: 300px">
                    <option value="">选择角色</option>
                    <volist name="rolelist" id="vo">
                        <option value="{$vo.id}">{$vo.name}</option>
                    </volist>
                </select>
            </li>
            <li><label>&nbsp;</label><input name="submit" type="button" class="btn do_save_btn" value="保存"/></li>
        </ul>
    </div>


</div>
</div>
<script>
    $(function () {
        var layer_index;
        $(document).on('click', '.edit_btn', function () {
            layer_index = layer.open({
                type: 1,
                title: '编辑账户',
                skin: 'layui-layer-rim', //加上边框
                area: ['365px', '420px'], //宽高
                content: $('#add_temp').html()
            });
            var _tr = $(this).parents('tr');
            var layer_obj = $('#layui-layer'+layer_index);
            layer_obj.find('.input_id').val(_tr.find('.td_id').html());
            layer_obj.find('.input_username').val(_tr.find('.td_username').html()).attr('readonly', true);
            layer_obj.find('.input_nickname').val(_tr.find('.td_nickname').html());
            layer_obj.find('.input_role_id').val(_tr.find('.td_role').attr('data-roleid'));
        });
        
        $(document).on('click', '.do_save_btn', function () {
            var layer_obj = $('#layui-layer'+layer_index);
            var id = layer_obj.find('.input_id').val();
            var password = layer_obj.find('.input_password').val();
            var nickname = layer_obj.find('.input_nickname').val();
            var role_id = layer_obj.find('.input_role_id').val();
            if (id == '') {
                layer.msg('参数错误', {icon: 2,time: 1000});
                return false;
            }
            $.ajax({
                type:'post',
                dataType:'json',
                data:{id:id,password:password,nickname:nickname,role_id:role_id},
                url:"{:U('Permission/editUser')}",
                success:function (response) {
                    if (response.code == 1) {
                        layer.msg('保存成功', {
                            icon: 1,
                            time: 1000
                        }, function(){
                            location.reload();
                        });
                    }else {
                        layer.msg(response.msg, {
                            icon: 2,
                            time: 1000
                        });
                    }
                }
            });
        });
        
        
        $(document).on('click', '.add_btn', function () {
            layer_index = layer.open({
                type: 1,
                title: '添加账户',
                skin: 'layui-layer-rim', //加上边框
                area: ['365px', '420px'], //宽高
                content: $('#add_temp').html()
            });
            $('#layui-layer'+layer_index).find('.btn').removeClass('do_save_btn').addClass('do_add_btn');
        });

        $(document).on('click', '.do_add_btn', function () {
            var layer_obj = $('#layui-layer'+layer_index);
            var username = layer_obj.find('.input_username').val();
            var password = layer_obj.find('.input_password').val();
            var nickname = layer_obj.find('.input_nickname').val();
            var role_id = layer_obj.find('.input_role_id').val();
            if (username == '' || nickname == '' || role_id == '') {
                layer.msg('您输入的信息不完整', {icon: 2,time: 1000});
                return false;
            }
            $.ajax({
                type:'post',
                dataType:'json',
                data:{username:username,password:password,nickname:nickname,role_id:role_id},
                url:"{:U('Permission/addUser')}",
                success:function (response) {
                    if (response.code == 1) {
                        layer.msg('保存成功', {
                            icon: 1,
                            time: 1000
                        }, function(){
                            location.reload();
                        });
                    }else {
                        layer.msg(response.msg, {
                            icon: 2,
                            time: 1000
                        });
                    }
                }
            });
        });
        
    });
</script>
<include file="Index/footer" />
